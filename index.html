<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Misi√≥n Caos: Uruguay</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Roboto:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --edu-color: #00d2ff;  /* Azul Ne√≥n */
            --dani-color: #ff0099; /* Rosa Ne√≥n */
            --vicky-color: #ffee00;/* Amarillo Ne√≥n */
            --bg-dark: #121212;
        }

        * { box-sizing: border-box; touch-action: manipulation; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- PANTALLAS --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: radial-gradient(circle, #222 0%, #000 100%);
            transition: opacity 0.5s;
            padding: 20px; text-align: center;
        }
        .hidden { opacity: 0; pointer-events: none; z-index: -1; }
        .active { opacity: 1; pointer-events: all; z-index: 10; }

        /* --- TIPOGRAF√çA --- */
        h1 {
            font-family: 'Black Ops One', cursive;
            font-size: 3rem; margin: 0;
            color: #fff;
            text-shadow: 0 0 15px rgba(255,255,255,0.5);
            animation: pulseTitle 2s infinite;
        }

        .player-name {
            font-family: 'Black Ops One', cursive;
            font-size: 4rem; margin: 10px 0;
            text-shadow: 0 0 20px currentColor;
        }

        .task-text {
            font-size: 1.8rem; font-weight: 900;
            margin: 20px 0; line-height: 1.2;
            color: #fff;
            min-height: 100px; /* Evita saltos de layout */
            display: flex; align-items: center; justify-content: center;
        }

        /* --- TEMPORIZADOR --- */
        #timer-display {
            font-family: 'Black Ops One', cursive;
            font-size: 6rem;
            color: #ff3333;
            text-shadow: 0 0 30px #ff0000;
            margin: 10px 0;
        }
        .timer-warning { animation: shake 0.5s infinite; color: #ff0000 !important; }

        /* --- BOTONES --- */
        .btn-big {
            background: transparent;
            border: 4px solid white;
            color: white;
            font-family: 'Black Ops One', cursive;
            font-size: 2rem;
            padding: 20px 40px;
            border-radius: 20px;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
            transition: transform 0.1s;
            width: 100%; max-width: 300px;
        }
        .btn-big:active { transform: scale(0.95); }

        .btn-success { border-color: #39ff14; color: #39ff14; box-shadow: 0 0 20px #39ff14; }
        .btn-fail { border-color: #ff0055; color: #ff0055; box-shadow: 0 0 20px #ff0055; }

        /* --- MARCADOR --- */
        #scoreboard {
            position: absolute; top: 0; left: 0; width: 100%;
            display: flex; justify-content: space-around;
            padding: 10px; background: rgba(255,255,255,0.05);
            backdrop-filter: blur(5px);
            z-index: 100;
        }
        .score-box { text-align: center; font-weight: bold; }
        .score-box span { display: block; font-size: 1.5rem; font-family: 'Black Ops One'; }
        
        @keyframes pulseTitle { 0%,100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }

    </style>
</head>
<body>

    <div id="scoreboard">
        <div class="score-box" style="color: var(--edu-color)">EDU<br><span id="score-edu">0</span></div>
        <div class="score-box" style="color: var(--vicky-color)">VICKY<br><span id="score-vicky">0</span></div>
        <div class="score-box" style="color: var(--dani-color)">DANI<br><span id="score-dani">0</span></div>
    </div>

    <div id="screen-start" class="screen active">
        <h1>MISI√ìN<br>CAOS</h1>
        <p style="font-size: 1.2rem; color: #aaa;">Edici√≥n Uruguay</p>
        <div style="font-size: 4rem; margin: 20px;">üá∫üáæ</div>
        <button class="btn-big" onclick="initGame()">¬°A JUGAR!</button>
    </div>

    <div id="screen-roulette" class="screen hidden">
        <h2 style="color:white;">EL TURNO ES DE...</h2>
        <div id="roulette-name" class="player-name" style="color: white;">...</div>
    </div>

    <div id="screen-mission" class="screen hidden">
        <div id="mission-player" class="player-name">EDU</div>
        <div style="font-size: 1.2rem; color:#aaa; text-transform: uppercase;">Misi√≥n:</div>
        <div id="mission-text" class="task-text">...</div>
        
        <div id="timer-display">30</div>

        <div id="action-buttons" style="display:none; width: 100%; display: flex; flex-direction: column; align-items: center;">
            <button class="btn-big btn-success" onclick="missionResult(true)">¬°LISTO! üòé</button>
            <button class="btn-big btn-fail" onclick="missionResult(false)">NO LLEGU√â üò≠</button>
        </div>
    </div>

    <script>
        // --- CONFIGURACI√ìN DE PRENDAS (SIN EJERCICIOS) ---
        const players = {
            'Edu': {
                color: 'var(--edu-color)',
                tasks: [
                    { t: "¬°Trae el mate de la cocina!", time: 30 },
                    { t: "¬°Trae un rollo de papel higi√©nico!", time: 25 },
                    { t: "¬°Trae el control remoto de la tele!", time: 25 },
                    { t: "¬°Busca un par de medias (calcetines)!", time: 25 },
                    { t: "¬°Hac√© una cara muy fea!", time: 10 },
                    { t: "Canta una canci√≥n de cancha.", time: 20 },
                    { t: "Trae un vaso con agua.", time: 30 },
                    { t: "Imit√° a un perro ladrando.", time: 10 }
                ]
            },
            'Dani': {
                color: 'var(--dani-color)',
                tasks: [
                    { t: "¬°Trae tu perfume favorito!", time: 30 },
                    { t: "¬°Busca una cuchara chica!", time: 25 },
                    { t: "¬°Trae un champi√≥n (zapatilla)!", time: 25 },
                    { t: "¬°Trae las llaves de la casa!", time: 30 },
                    { t: "Dale un abrazo fuerte a Vicky.", time: 15 },
                    { t: "Baila como una loca por 10 segundos.", time: 15 },
                    { t: "Trae una fruta de la cocina.", time: 25 },
                    { t: "Hac√© como si estuvieras manejando un auto.", time: 15 }
                ]
            },
            'Vicky': {
                color: 'var(--vicky-color)',
                tasks: [
                    { t: "¬°Trae tu peluche preferido!", time: 30 },
                    { t: "¬°Busca una almohada!", time: 30 },
                    { t: "¬°Trae un dibujo tuyo!", time: 40 },
                    { t: "¬°Tocale la nariz a Pap√°!", time: 15 },
                    { t: "¬°Tocale la oreja a Mam√°!", time: 15 },
                    { t: "Hac√© ruido de le√≥n: ¬°Grrr!", time: 10 },
                    { t: "Salt√° 5 veces bien alto.", time: 15 },
                    { t: "Escondete atr√°s del sill√≥n.", time: 15 },
                    { t: "Trae una chinela (ojota).", time: 30 }
                ]
            }
        };

        const scores = { 'Edu': 0, 'Dani': 0, 'Vicky': 0 };
        let currentPlayer = '';
        let lastPlayer = ''; // Para evitar repeticiones
        let timerInterval;
        let audioCtx;
        const synth = window.speechSynthesis; // Voz del navegador

        // --- SISTEMA DE AUDIO ---
        function initAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if(audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playTone(type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if(type === 'tick') {
                osc.type = 'square'; osc.frequency.setValueAtTime(800, now);
                gain.gain.setValueAtTime(0.05, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'alarm') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(600, now); osc.frequency.linearRampToValueAtTime(100, now + 0.5);
                gain.gain.setValueAtTime(0.3, now); gain.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(now); osc.stop(now + 0.5);
            } else if (type === 'spin') {
                 osc.type = 'sine'; osc.frequency.value = 200 + Math.random()*400;
                 gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                 osc.start(now); osc.stop(now + 0.1);
            }
        }

        function speak(text) {
            if (synth.speaking) synth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-ES'; // Intenta espa√±ol gen√©rico
            utterance.rate = 1.0;
            utterance.pitch = 1.1;
            synth.speak(utterance);
        }

        // --- L√ìGICA DEL JUEGO ---
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('active'); s.classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
            document.getElementById(id).classList.add('active');
        }

        function initGame() {
            initAudio();
            // Truco para despertar la voz en m√≥viles (necesita interacci√≥n usuario)
            const blank = new SpeechSynthesisUtterance('');
            synth.speak(blank);
            spinRoulette();
        }

        function spinRoulette() {
            showScreen('screen-roulette');
            const names = ['Edu', 'Dani', 'Vicky'];
            const el = document.getElementById('roulette-name');
            let counter = 0;
            let maxSpins = 20;
            
            const interval = setInterval(() => {
                playTone('spin');
                let randomName;
                
                // L√≥gica visual de ruleta
                randomName = names[Math.floor(Math.random() * names.length)];
                el.innerText = randomName;
                el.style.color = players[randomName].color;
                
                counter++;
                if (counter > maxSpins) {
                    clearInterval(interval);
                    
                    // L√≥gica REAL de selecci√≥n (No repetir jugador anterior)
                    let selectedName;
                    do {
                        selectedName = names[Math.floor(Math.random() * names.length)];
                    } while (selectedName === lastPlayer && names.length > 1);
                    
                    lastPlayer = selectedName;
                    currentPlayer = selectedName;
                    
                    // Mostrar resultado final visualmente
                    el.innerText = currentPlayer;
                    el.style.color = players[currentPlayer].color;
                    
                    setTimeout(startMission, 1000);
                }
            }, 100);
        }

        function startMission() {
            const pData = players[currentPlayer];
            const taskObj = pData.tasks[Math.floor(Math.random() * pData.tasks.length)];
            
            document.getElementById('mission-player').innerText = currentPlayer;
            document.getElementById('mission-player').style.color = pData.color;
            document.getElementById('mission-text').innerText = taskObj.t;
            
            showScreen('screen-mission');
            
            // HABLAR
            speak(`${currentPlayer}. ${taskObj.t}`);

            // Timer
            let timeLeft = taskObj.time;
            const timerEl = document.getElementById('timer-display');
            const btns = document.getElementById('action-buttons');
            
            timerEl.innerText = timeLeft;
            timerEl.classList.remove('timer-warning');
            btns.style.display = 'flex'; 

            if(timerInterval) clearInterval(timerInterval);

            timerInterval = setInterval(() => {
                timeLeft--;
                timerEl.innerText = timeLeft;
                if(timeLeft > 0 && timeLeft <= 10) playTone('tick'); // Tictac solo al final

                if (timeLeft <= 5) timerEl.classList.add('timer-warning');

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerEl.innerText = "¬°TIEMPO!";
                    playTone('alarm');
                    speak("¬°Se termin√≥ el tiempo!");
                    if(navigator.vibrate) navigator.vibrate(800);
                }
            }, 1000);
        }

        function missionResult(success) {
            clearInterval(timerInterval);
            if (success) {
                scores[currentPlayer] += 100;
                document.getElementById(`score-${currentPlayer.toLowerCase()}`).innerText = scores[currentPlayer];
                speak("¬°Muy bien!");
            } else {
                playTone('alarm');
                speak("¬°Oh no! Fallaste.");
            }
            
            setTimeout(spinRoulette, 1500);
        }

    </script>
</body>
</html>