<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>¬øQui√©n Soy Yo?</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Roboto:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #2c3e50;
            --card-bg: #ecf0f1;
            --green: #2ecc71;
            --red: #e74c3c;
            --blue: #3498db;
            --yellow: #f1c40f;
        }

        * { box-sizing: border-box; touch-action: manipulation; user-select: none; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: #333;
            font-family: 'Fredoka One', cursive;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* PANTALLAS */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 0.3s ease-in-out;
            background: radial-gradient(circle at center, #34495e 0%, #2c3e50 100%);
            padding: 20px;
            text-align: center;
        }
        .hidden { transform: translateY(100vh); pointer-events: none; }
        .active { transform: translateY(0); }

        /* INICIO */
        h1 {
            color: var(--yellow); font-size: 3rem; margin-bottom: 10px;
            text-shadow: 4px 4px 0 #000; letter-spacing: 2px;
        }
        
        .btn-start {
            background: var(--green); color: white; border: none;
            padding: 20px 50px; font-size: 2rem; border-radius: 50px;
            box-shadow: 0 10px 0 #27ae60; cursor: pointer; margin-top: 30px;
            font-family: 'Fredoka One'; transition: transform 0.1s;
        }
        .btn-start:active { transform: translateY(5px); box-shadow: 0 5px 0 #27ae60; }

        /* JUEGO */
        #game-area {
            width: 100%; height: 100%; display: flex; flex-direction: column;
            background: white;
        }

        #top-bar {
            height: 80px; background: #333; color: white;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; font-size: 2rem;
        }

        #card-display {
            flex-grow: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: var(--card-bg); position: relative;
            border-bottom: 10px solid #bdc3c7;
        }

        #word-emoji { font-size: 8rem; margin: 0; line-height: 1; }
        #word-text { font-size: 3.5rem; margin: 20px 0; color: #2c3e50; text-transform: uppercase; }

        /* Zonas de Toque (Botones invisibles gigantes) */
        #controls {
            height: 30%; display: flex; width: 100%;
        }
        .touch-zone {
            width: 50%; height: 100%; display: flex;
            align-items: center; justify-content: center;
            font-size: 2rem; color: white; cursor: pointer;
        }
        #btn-pass { background-color: var(--red); border-top: 5px solid #c0392b; }
        #btn-correct { background-color: var(--green); border-top: 5px solid #27ae60; }

        /* INSTRUCCIONES */
        .instruction-box {
            background: white; color: #333; padding: 20px; border-radius: 20px;
            font-family: 'Roboto'; font-size: 1.2rem; max-width: 400px;
        }

        /* RESULTADOS */
        .score-list {
            list-style: none; padding: 0; width: 100%; max-width: 400px;
        }
        .score-item {
            background: rgba(255,255,255,0.1); margin: 10px 0; padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 10px; color: white; font-size: 1.5rem;
        }

        /* Animaciones */
        @keyframes pop { 0% { transform: scale(0.5); opacity:0; } 70% { transform: scale(1.1); } 100% { transform: scale(1); opacity:1;} }
        .pop-in { animation: pop 0.3s forwards; }

    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <h1>¬øQUI√âN<br>SOY?</h1>
        <div style="font-size: 4rem;">ü§îüí≠üé≠</div>
        
        <div class="instruction-box">
            <p>1. El juego elige un jugador.</p>
            <p>2. Ponte el celular en la <b>FRENTE</b> mirando a los dem√°s.</p>
            <p>3. ¬°Los dem√°s hacen m√≠mica!</p>
            <p>4. Toca la pantalla: <br>üü• IZQUIERDA = PASAR<br>üü© DERECHA = ¬°ACERTASTE!</p>
        </div>

        <button class="btn-start" onclick="startGameLoop()">JUGAR</button>
    </div>

    <div id="screen-prep" class="screen hidden" style="background: var(--blue);">
        <h2 style="color:white; font-size: 2rem;">TURNO DE:</h2>
        <h1 id="prep-player" style="font-size: 4rem; margin: 0; color: white;">...</h1>
        <p style="color:white; font-size: 1.5rem; margin-top: 20px;">Ponte el celular en la frente...</p>
        <button class="btn-start" style="background: white; color: var(--blue);" onclick="startRound()">¬°LISTO!</button>
    </div>

    <div id="screen-game" class="screen hidden" style="padding: 0;">
        <div id="game-area">
            <div id="top-bar">
                <span id="game-player">EDU</span>
                <span id="timer">60</span>
            </div>
            
            <div id="card-display">
                <div id="word-emoji">‚ùì</div>
                <div id="word-text">PREPARADOS...</div>
            </div>

            <div id="controls">
                <div id="btn-pass" class="touch-zone" onclick="handleAnswer(false)">
                    PASO üëé
                </div>
                <div id="btn-correct" class="touch-zone" onclick="handleAnswer(true)">
                    ¬°S√ç! üëç
                </div>
            </div>
        </div>
    </div>

    <div id="screen-score" class="screen hidden">
        <h1>¬°TIEMPO!</h1>
        <h2 style="color: var(--yellow);">Puntos de la ronda: <span id="round-score">0</span></h2>
        
        <ul class="score-list">
            <li class="score-item">
                <span>EDU üë®üèª</span> <span id="total-edu">0</span>
            </li>
            <li class="score-item">
                <span>DANI üë©üèª</span> <span id="total-dani">0</span>
            </li>
            <li class="score-item">
                <span>VICKY üëßüèº</span> <span id="total-vicky">0</span>
            </li>
        </ul>

        <button class="btn-start" onclick="startGameLoop()">SIGUIENTE</button>
    </div>

    <script>
        // --- BASE DE DATOS DE PALABRAS ---
        // Mezclamos cosas f√°ciles para Vicky y cosas de Uruguay para los pap√°s
        const dictionary = [
            // Animales
            { w: "PERRO", e: "üê∂" }, { w: "GATO", e: "üê±" }, { w: "LE√ìN", e: "ü¶Å" },
            { w: "MONO", e: "üêµ" }, { w: "VACA", e: "üêÆ" }, { w: "CHANCHO", e: "üê∑" },
            { w: "DINOSAURIO", e: "ü¶ñ" }, { w: "UNICORNIO", e: "ü¶Ñ" }, { w: "MARIPOSA", e: "ü¶ã" },
            { w: "ARA√ëA", e: "üï∑Ô∏è" }, { w: "CARPINCHO", e: "ü¶¶" }, { w: "TERO", e: "ü¶Ö" },
            { w: "MULITA", e: "üêÅ" }, { w: "SAPO", e: "üê∏" },
            
            // Comida
            { w: "MATE", e: "üßâ" }, { w: "PIZZA", e: "üçï" }, { w: "HELADO", e: "üç¶" },
            { w: "BANANA", e: "üçå" }, { w: "ASADO", e: "ü•©" }, { w: "TORTA FRITA", e: "ü´ì" },
            { w: "DULCE DE LECHE", e: "üçØ" }, { w: "CHIVITO", e: "üçî" },
            
            // Personajes & Cosas
            { w: "PRINCESA", e: "üë∏" }, { w: "FANTASMA", e: "üëª" }, { w: "ROBOT", e: "ü§ñ" },
            { w: "ZOMBIE", e: "üßü" }, { w: "BEB√â", e: "üë∂" }, { w: "ABUELA", e: "üëµ" },
            { w: "POLIC√çA", e: "üëÆ" }, { w: "PELOTA", e: "‚öΩ" }, { w: "TAMBORIL", e: "ü•Å" },
            { w: "AUTO", e: "üöó" }, { w: "AVI√ìN", e: "‚úàÔ∏è" }, { w: "SOL", e: "‚òÄÔ∏è" },
            
            // Acciones / Uruguayismos
            { w: "BAILANDO", e: "üíÉ" }, { w: "DURMIENDO", e: "üò¥" }, { w: "LLORANDO", e: "üò≠" },
            { w: "TOMANDO MATE", e: "üßâ" }, { w: "F√öTBOL", e: "‚öΩ" }, { w: "PLAYA", e: "üèñÔ∏è" },
            { w: "FR√çO", e: "ü•∂" }, { w: "CALOR", e: "ü•µ" }, { w: "BA√ëARSE", e: "üöø" }
        ];

        // --- ESTADO DEL JUEGO ---
        const players = ["EDU", "DANI", "VICKY"];
        let scores = { "EDU": 0, "DANI": 0, "VICKY": 0 };
        let currentPlayerIdx = 0; // Empieza Edu (luego rotamos)
        let currentRoundScore = 0;
        let timerInterval;
        let timeLeft = 60;
        let usedWords = [];
        let currentWord = {};
        
        // --- AUDIO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.setValueAtTime(1200, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now); osc.stop(now + 0.3);
            } else if (type === 'pass') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            } else if (type === 'tick') {
                osc.type = 'square';
                osc.frequency.value = 800;
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                osc.start(now); osc.stop(now + 0.05);
            } else if (type === 'end') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.linearRampToValueAtTime(300, now + 1);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.linearRampToValueAtTime(0, now + 1);
                osc.start(now); osc.stop(now + 1);
            }
        }

        // --- NAVEGACI√ìN ---
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('active');
                s.classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
            document.getElementById(id).classList.add('active');
        }

        // --- L√ìGICA ---

        function startGameLoop() {
            // Determinar jugador
            const player = players[currentPlayerIdx];
            document.getElementById('prep-player').innerText = player;
            showScreen('screen-prep');
            
            // Voz
            const utterance = new SpeechSynthesisUtterance(`Turno de ${player}. Ponte el celular en la frente.`);
            utterance.lang = 'es-ES';
            window.speechSynthesis.speak(utterance);
        }

        function startRound() {
            currentRoundScore = 0;
            timeLeft = 60;
            document.getElementById('timer').innerText = timeLeft;
            document.getElementById('game-player').innerText = players[currentPlayerIdx];
            
            showScreen('screen-game');
            nextWord();

            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = timeLeft;
                
                if (timeLeft <= 10) {
                    document.getElementById('timer').style.color = 'red';
                    playSound('tick');
                } else {
                    document.getElementById('timer').style.color = 'white';
                }

                if (timeLeft <= 0) {
                    endRound();
                }
            }, 1000);
        }

        function nextWord() {
            // Elegir palabra que no se haya usado reci√©n (simple random por ahora)
            let newWord;
            do {
                newWord = dictionary[Math.floor(Math.random() * dictionary.length)];
            } while (newWord.w === currentWord.w);
            
            currentWord = newWord;
            
            // Animaci√≥n de entrada
            const textEl = document.getElementById('word-text');
            const emojiEl = document.getElementById('word-emoji');
            
            textEl.classList.remove('pop-in');
            void textEl.offsetWidth; // trigger reflow
            textEl.innerText = currentWord.w;
            emojiEl.innerText = currentWord.e;
            textEl.classList.add('pop-in');
        }

        function handleAnswer(isCorrect) {
            if (timeLeft <= 0) return;

            if (isCorrect) {
                playSound('correct');
                currentRoundScore++;
                // Flash verde visual
                document.getElementById('card-display').style.background = '#a8e6cf';
                setTimeout(() => document.getElementById('card-display').style.background = '#ecf0f1', 200);
            } else {
                playSound('pass');
                // Flash rojo visual
                document.getElementById('card-display').style.background = '#ff8b94';
                setTimeout(() => document.getElementById('card-display').style.background = '#ecf0f1', 200);
            }
            nextWord();
        }

        function endRound() {
            clearInterval(timerInterval);
            playSound('end');
            
            // Actualizar puntajes
            const player = players[currentPlayerIdx];
            scores[player] += currentRoundScore;
            
            // Mostrar Pantalla Final
            document.getElementById('round-score').innerText = currentRoundScore;
            document.getElementById('total-edu').innerText = scores['EDU'];
            document.getElementById('total-dani').innerText = scores['DANI'];
            document.getElementById('total-vicky').innerText = scores['VICKY'];
            
            showScreen('screen-score');
            
            // Voz
            const msg = new SpeechSynthesisUtterance(`Tiempo. Hiciste ${currentRoundScore} puntos.`);
            msg.lang = 'es-ES';
            window.speechSynthesis.speak(msg);

            // Siguiente jugador
            currentPlayerIdx++;
            if (currentPlayerIdx >= players.length) currentPlayerIdx = 0;
        }

    </script>
</body>
</html>